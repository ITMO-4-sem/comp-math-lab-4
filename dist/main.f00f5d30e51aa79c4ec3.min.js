(()=>{"use strict";class t{constructor(t,e){if(t.length!=e.length)throw new Error("xValues and yValues rows must be of the same length.");this.xValues=t,this.yValues=e}size(){return this.xValues.length}getXValues(){return this.xValues}getYValues(){return this.yValues}}class e{isRateValid(t){return!isNaN(t)&&isFinite(t)}areRatesValid(...t){let e=!0;for(let n=0;n<t.length&&(e=e&&this.isRateValid(t[n]),e);n++);return e}}class n extends e{approximate(t){let e=0,n=0,r=0,s=0;const o=t.getXValues(),i=t.getYValues(),a=o.length;for(let t=0;t<a;t++){const a=o[t],l=i[t];l<=0||(e+=a*Math.log(l),r+=a,n+=Math.log(l),s+=a*a)}const l=(a*e-r*n)/(a*s-r*r),c=1/a*n-l/a*r;if(!this.areRatesValid(c,l))throw new Error("Can't perform calculations. Division by zero or other calculation error. Please, enter different data.");return{a:c,b:l}}}class r extends e{approximate(t){let e=0,n=0,r=0,s=0,o=0;const i=t.getXValues(),a=t.getYValues(),l=i.length;for(let t=0;t<l;t++){const l=i[t],c=a[t];e+=l,n+=l*l,r+=c,s+=c*c,o+=l*c}const c=n*l-e*e,u=(o*l-e*r)/c,h=(n*r-e*o)/c,m=(l*o-e*r)/Math.sqrt((l*n-e*e)*(l*s-r*r));if(!this.areRatesValid(u,h,m))throw new Error("Can't perform calculations. Division by zero.");return{a:u,b:h,ext:m}}}class s extends e{approximate(t){let e=0,n=0,r=0,s=0;const o=t.getXValues(),i=t.getYValues(),a=o.length;for(let t=0;t<a;t++){const a=o[t],l=i[t];a<=0||(e+=l*Math.log(a),n+=Math.log(a),r+=l,s+=Math.log(a)*Math.log(a))}const l=(a*e-n*r)/(a*s-n*n),c=1/a*r-l/a*n;if(!this.areRatesValid(c,l))throw new Error("Can't perform calculations. Division by zero.");return{a:c,b:l}}}class o extends e{approximate(t){let e=0,n=0,r=0,s=0;const o=t.getXValues(),i=t.getYValues(),a=o.length;for(let t=0;t<a;t++){const a=o[t],l=i[t];a<=0||l<=0||(e+=Math.log(a)*Math.log(l),n+=Math.log(a),r+=Math.log(l),s+=Math.log(a)*Math.log(a))}const l=(a*e-n*r)/(a*s-n*n),c=Math.exp(1/a*r-l/a*n);if(!this.areRatesValid(c,l))throw new Error("Can't perform calculations. Division by zero.");return{a:c,b:l}}}class i{constructor(t,e,n){this.a=t,this.b=e,this.c=n}}class a{constructor(...t){const e=t.length;if(e<2)throw new Error("The matrix size must be at least 2.");for(const n of t)if(n.length!==e+1)throw new Error(`'Invalid number of numbers in the matrix row. Must be: ${e}, got: ${n.length}. Row: \n                    \n ${n}`);this.matrix=t,this.matrixSize=e}getColumn(t){if(t>this.matrix[0].length-1)throw new Error("Column number must not be greater the number of columns in the matrix minus one.");const e=new Array;for(let n=0;n<this.matrixSize;n++)e.push(this.matrix[n][t]);return e}getLastColumn(){return this.getColumn(this.matrixSize)}setColumn(t,e){if(e>this.matrix[0].length-1)throw new Error("Column index can't be more than number of columns.");if(t.length!=this.matrix.length)throw new Error("Column length must be the same as the matrix's ones.");for(let n=0;n<t.length;n++)this.matrix[n][e]=t[n]}clone(){const t=new Array;for(const e of this.matrix){const n=new Array;for(const t of e)n.push(t);t.push(n)}return new a(...t)}getMatrix(){return this.matrix}getMatrixSize(){return this.matrixSize}}class l extends e{approximate(t){let e=0,n=0,r=0,s=0,o=0,l=0,c=0;const u=t.getXValues(),h=t.getYValues(),m=u.length;for(let t=0;t<m;t++){const i=u[t],a=h[t];e+=i,n+=i*i,r+=i*i*i,s+=i*i*i*i,o+=a,l+=i*a,c+=i*i*a}const p=new a(new Array(m,e,n,o),new Array(e,n,r,l),new Array(n,r,s,c)),g=class{static solve(t){if(3!=t.getMatrixSize())throw new Error("Sorry, I'm too dull to solve any matrix containing not 3 variables.");const e=t.getLastColumn();let n=t.clone();const r=this.findDeterminant(n);n.setColumn(e,0);const s=this.findDeterminant(n);n=t.clone(),n.setColumn(e,1);const o=this.findDeterminant(n);n=t.clone(),n.setColumn(e,2);const a=this.findDeterminant(n);return new i(s/r,o/r,a/r)}static findDeterminant(t){const e=t.getMatrix();return e[0][0]*e[1][1]*e[2][2]+e[0][1]*e[1][2]*e[2][0]+e[0][2]*e[1][0]*e[2][1]-e[0][2]*e[1][1]*e[2][0]-e[0][1]*e[1][0]*e[2][2]-e[0][0]*e[1][2]*e[2][1]}}.solve(p),x=g.c,f=g.b,d=g.a;if(!this.areRatesValid(x,f,d))throw new Error("Can't perform calculations. Division by zero.");return{a:x,b:f,ext:d}}}class c{constructor(t,e){this.a=t,this.b=e}}var u;!function(t){t.EXPONENTIAL_FUNCTION="exponentialFunction",t.LINEAR_FUNCTION="linearFunction",t.LOGARITHMIC_FUNCTION="logarithmicFunction",t.POWER_FUNCTION="powerFunction",t.QUADRATIC_FUNCTION="quadraticFunction"}(u||(u={}));class h extends c{calc(t){return Math.exp(this.a+this.b*t)}getLatexRepresentation(t){let e=this.a.toString(),n=this.b.toString();return t&&(e=this.a.toFixed(t),n=this.b.toFixed(t)),`e^{${e} + ${n} * x}`}getName(){return u.EXPONENTIAL_FUNCTION}}class m extends c{calc(t){return this.a*t+this.b}getLatexRepresentation(t){let e=this.a.toString(),n=this.b.toString();return t&&(e=this.a.toFixed(t),n=this.b.toFixed(t)),`${e} * x + ${n}`}getName(){return u.LINEAR_FUNCTION}}class p extends c{calc(t){return this.a+this.b*Math.log(t)}getLatexRepresentation(t){let e=this.a.toString(),n=this.b.toString();return t&&(e=this.a.toFixed(t),n=this.b.toFixed(t)),`${e} + ${n} * \\ln(x)`}getName(){return u.LOGARITHMIC_FUNCTION}}class g extends c{calc(t){return this.a*Math.pow(t,this.b)}getLatexRepresentation(t){let e=this.a.toString(),n=this.b.toString();return t&&(e=this.a.toFixed(t),n=this.b.toFixed(t)),`${e} * x^{${n}}`}getName(){return u.POWER_FUNCTION}}class x extends c{constructor(t,e,n){super(t,e),this.c=n}calc(t){return this.a*t*t+this.b*t+this.c}getLatexRepresentation(t){let e=this.a.toString(),n=this.b.toString(),r=this.c.toString();return t&&(e=this.a.toFixed(t),n=this.b.toFixed(t),r=this.c.toFixed(t)),`${e}*x^2 + ${n}*x + ${r}`}getName(){return u.QUADRATIC_FUNCTION}}class f{calculate(t){const e=t.size(),i=t.getYValues(),a=t.getXValues(),c=(new n).approximate(t),u=(new r).approximate(t),f=(new s).approximate(t),d=(new o).approximate(t),w=(new l).approximate(t),b=new Array;b.push(c),b.push(u),b.push(f),b.push(d),b.push(w);const F=new Array;F.push(new h(c.a,c.b)),F.push(new m(u.a,u.b)),F.push(new p(f.a,f.b)),F.push(new g(d.a,d.b)),F.push(new x(w.a,w.b,w.ext));const C=new Array;for(let t=0;t<5;t++){const n=F[t],r=b[t],s=this.prepareApproxFuncYValues(a,n);console.log("yValues = ",s);const o=this.calcDeviationMeasure(i,s),l=this.calcStandardDeviation(o,e),c=this.calcApproximationFunctionReliability(o,s,e);C.push({funcName:n.getName(),func:n,yValues:s,approxResult:r,approximationReliability:c,deviationMeasure:o,standardDeviation:l})}return C}prepareApproxFuncYValues(t,e){const n=new Array;for(let r=0;r<t.length;r++)n.push(e.calc(t[r]));return n}calcDeviationMeasure(t,e){let n=0;for(let r=0;r<t.length;r++)n+=Math.pow(e[r]-t[r],2);return n}calcStandardDeviation(t,e){return Math.sqrt(t/e)}calcApproximationFunctionReliability(t,e,n){let r=0,s=0;for(let t=0;t<e.length;t++){const n=e[t];r+=n,s+=n*n}return 1-t/(s-1/n*r*r)}}const d=document.querySelector(".desmos"),w=Desmos.GraphingCalculator(d);console.log("desmos = ",w);const b=document.querySelector(".button-submit"),F=document.querySelector(".textarea");window.textArea=F;const C=document.querySelector(".general-result"),N=document.querySelector(".best-function"),I=document.querySelector(".notification"),S=document.querySelector(".notification__content");(new class{constructor(){if(this.FILE_INPUT__INPUT_DOM_CLASS="file-input__input",this.FILE_INPUT__STATUS_DOM_CLASS="file-input__status",this.onFileChosenCallbacks=[],this.elFileInputInput=document.querySelector("."+this.FILE_INPUT__INPUT_DOM_CLASS),this.elFileInputStatus=document.querySelector("."+this.FILE_INPUT__STATUS_DOM_CLASS),null===this.elFileInputInput||null===this.elFileInputStatus)throw new Error("Invalid class names of html elements.");this.init()}init(){this.elFileInputInput.addEventListener("change",(t=>{const e=this.elFileInputInput.files;console.warn("input value is ..",this.elFileInputInput.value),e&&0!=e.length?(this.elFileInputStatus.innerText=e[0].name,this.emitOnFileChosenCallbacks(e[0])):this.elFileInputStatus.innerText="No file chosen"}))}onFileChosen(t){this.onFileChosenCallbacks.push(t)}emitOnFileChosenCallbacks(t){for(const e of this.onFileChosenCallbacks)e.onChosen(t)}}).onFileChosen({onChosen(t){!function(t){const e=new FileReader;e.readAsText(t),e.onload=()=>{F.value=e.result},e.onerror=()=>{console.error("Не могу прочитать файл")}}(t)}});let y=new t(new Array(1.1,2.3,3.7,4.5,5.4,6.8,7.5),new Array(2.73,5.12,7.74,8.91,10.59,12.75,13.43));function A(t){return"string"==typeof t&&(!isNaN(Number(t))&&!isNaN(parseFloat(t)))}function _(){I.classList.add("notification--hidden")}function V(t){return JSON.stringify(t,void 0,2)}function E(t){let e="";const n=t.getXValues(),r=t.getYValues();for(let s=0;s<t.size();s++)e+=`(${n[s]}, ${r[s]}),`;return e.slice(0,-1)}b.addEventListener("click",(()=>{console.log("YES"),_();try{y=function(e){const n=e.trim().split("\n");if(2!=n.length)throw new Error("Входные данные должны состоять из 2 строк");const r=n[0].trim().split(" "),s=n[1].trim().split(" ");if(console.log("tmpX = ",r),console.log("tmpY = ",s),r.length!=s.length)throw new Error("Количество иксов должно быть равно количеству игреков");const o=new Array,i=new Array;for(const t of r){if(!A(t))throw new Error("Неправильный x: "+t);o.push(parseFloat(t))}for(const t of s){if(!A(t))throw new Error("Неправильный y: "+t);i.push(parseFloat(t))}return new t(o,i)}(F.value),function(t){const e=(new f).calculate(t);w.setBlank(),w.setExpression({id:"dots",latex:E(t),color:"red"});for(const t of e)w.setExpression({id:t.funcName,latex:t.func.getLatexRepresentation(3)});e.sort(((t,e)=>t.standardDeviation-e.standardDeviation)),N.textContent=V(e[0]),C.textContent=V(e),console.log("[0]",e[0])}(y)}catch(t){!function(t,e){const n=e||6e3;(function(t){S.innerText=t,I.classList.remove("notification--hidden")})(t),setTimeout((()=>{_()}),n)}(t)}}))})();